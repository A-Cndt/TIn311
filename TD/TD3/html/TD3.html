<!DOCTYPE html>
<html lang="fr-FR">
	<head>
		<title>TIn 311 - TD 3</title>
		<meta charset="utf-8">
		<meta lang="fr-FR">
		<link rel="stylesheet" href="../ressources/css/td.css">
		<script src="../ressources/js/td.js" type="text/javascript"></script>
	</head>
	
	<body>
		<div class="header">
			<hr>
			<h1 class="title">TD 3 - Premiers pas en SQL</h1>
			<p class="details">TIn 311 - Initiation aux bases de données</p>
			<p class="author">Alexandre CONDETTE - <a class="email" href="mailto:alexandre.condette@cnes.fr">alexandre.condette@cnes.fr</a></p>
			<p class="year">2023 - 2024</p>
			<img class="logo_ipsa" src="../ressources/imgs/logo_ipsa.png">
			<hr>
		</div>
		
		<div class="exercices">
			<div class="ex1">
				<h2 class="title">Exercice 1 : Internet of Things</h2>
				
				L'internet des objets (Internet of Things) désigne l'interconnexion entre Internet et des objets, des lieux et des environnements physiques. 
				<br/>
				Cette appellation désigne un nombre croissant d'objets connectés à Internet, permettant ainsi une communication entre nos biens dits physiques et leurs existences numériques. Ces formes de connexions permettent de rassembler de nouvelles masses de données sur le réseau (source: Wikipédia)
				<br/>
				<br/>
				Dans ce contexte, nous souhaiterions modéliser une plateforme de gestion de services : 
				<ul>
					<li>Des utilisateurs, qui possèdent un ou plusieurs objets connectés, souscrivent à des services</li>
					<li>Lorsque les objets envoient des données, elles sont transmises aux services souscrits par leur propriétaires</li>
				</ul>
				Afin de savoir à qui les objets connectés appartiennent et quels sont les services souscrits par leurs propriétaires, nous utilisons une base de données que nous allons modéliser : 
				<ul>
					<li>Un utilisateur possède un identifiant, nom, prénom ainsi qu'une adresse mail</li>
					<li>Chaque objet connecté est identifié par son adresse réseau physique (MAC) sur 17 caractères, peut avoir un type particulier et fournir des paramètres optionnels</li>
					<li>Un service donné possède un identifiant, éventuellement un nom et un type particulier</li>
				</ul>
				
				<h3>1.1. Réaliser le MCD et le MLD de cette base de données</h3>
				<h3>1.2. Créér et supprimer une table</h3>
				<h4>Langage SQL</h4>
				<code> 
					<p style="color:green">-- Requete SQL pour créer une table</p>
					<span style="color:magenta">CREATE TABLE</span> MaTable(<br/>
						&nbsp;&nbsp;Cle_primaire TYPE <span style="color:darkblue">NOT NULL</span>,<br>
						&nbsp;&nbsp;Cle_etrangere TYPE <span style="color:darkblue">NOT NULL</span>,<br>
						&nbsp;&nbsp;Attribut TYPE,<br>
						<br>
						&nbsp;&nbsp;<span style="color:darkblue">PRIMARY KEY</span>(Cle_primaire),<br>
						&nbsp;&nbsp;<span style="color:darkblue">FOREIGN KEY</span>(Cle_etrangere) <span style="color:darkblue">REFERENCES</span> AutreTable(Cle_primaire2)<br>
					) ;
					
					<p style="color:green">-- Requete SQL pour supprimer une table et toutes les données qu'elle contient</p>
					<span style="color:magenta">DROP TABLE</span> MaTable ;<br/>
				</code>
				<h4>Créer des tables</h4>
				Dans DB Browser créer une nouvelle base de données <em>"Platform_IoT.db"</em> <br>
				Dans cette base nouvellement créée, ajouter les tables identifiées dans votre MLD.
				
				<h3>1.3. Insertion de données</h3>
				<h4>Langage SQL</h4>
				<code> 
					<p style="color:green">-- Créer un utilisateur en donnant les valeurs de chaque colonnes</p>
					<span style="color:magenta">INSERT INTO</span> Utilisateur <span style="color:magenta">VALUES</span> (1, <span style="color:darkred">'Martin'</span>, <span style="color:darkred">'SOLVEIG'</span>, <span style="color:darkred">'martin.solveig@ipsa.fr'</span>);<br/>
					<p style="color:green">-- Créer un utilisateur en donnant que les valeurs des collones NOT NULL</p>
					<span style="color:magenta">INSERT INTO</span> Utilisateur <span style="color:magenta">VALUES</span> (2, <span style="color:darkred">'Mickey'</span>, <span style="color:darkred">'MOUSE'</span>);<br/>
				</code>
				Attention, insérer 2 lignes avec la même clé primaire, ou insérer une ligne en ommetant une colonne "NOT NULL" engendrera une erreur.
				
				<h4>Insérer des utilisateurs</h4>
				<table valign="top">
					<tr>
						<th>ID</th>
						<th>Nom</th>
						<th>Prénom</th>
						<th>Mail</th>
					</tr>
					<tr>
						<td>1</td>
						<td>Sacre</td>
						<td>Frederic</td>
						<td>frederic.sacre@ipsa.fr</td>
					</tr>
					</tr>
					<tr>
						<td>2</td>
						<td>Meunier</td>
						<td>Anne</td>
						<td>anne.meunier@ipsa.fr</td>
					</tr>
					</tr>
					<tr>
						<td>3</td>
						<td>Leleu</td>
						<td>Maurice</td>
						<td></td>
					</tr>
					</tr>
					<tr>
						<td>4</td>
						<td>Condette</td>
						<td>Alexandre</td>
						<td>alexandre.condette@spacebel.fr</td>
					</tr>
					</tr>
					<tr>
						<td>5</td>
						<td>Pereira</td>
						<td>Agathe</td>
						<td>apa@cnes.fr</td>
					</tr>
				</table>
				
				<h4>Insérer des Services</h4>
				<table valign="top">
					<tr>
						<th>Nom</th>
						<th>Type</th>
					</tr>
					<tr>
						<td>myKWHome</td>
						<td>smarthome</td>
					</tr>
					<tr>
						<td>FIrdgAlert</td>
						<td>smarthome</td>
					</tr>
					<tr>
						<td>myKWRUNstatsHome</td>
						<td>quantifiedself</td>
					</tr>
					<tr>
						<td>traCARE</td>
						<td>quantifiedself</td>
					</tr>
					<tr>
						<td>dogWATCH</td>
						<td></td>
					</tr>
					<tr>
						<td>carUse</td>
						<td></td>
					</tr>
				</table>
				
				<h4>Insérer des Objets</h4>
				<table valign="top">
					<tr>
						<th>Adresse MAC</th>
						<th>ID_Utilisateur</th>
						<th>Type</th>
						<th>Paramètre</th>
					</tr>
					<tr>
						<td>f0:de;f1:39:7f:17</td>
						<td>1</td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>f0:de;f1:39:7f:18</td>
						<td>2</td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td>f0:de;f1:39:7f:19</td>
						<td>2</td>
						<td>thingtempo</td>
						<td>60</td>
					</tr>
				</table>
				
				<h4>Insérer des Souscriptions</h4>
				<table valign="top">
					<tr>
						<th>ID_Utilisateur</th>
						<th>ID_Service</th>
					</tr>
					<tr>
						<td>2</td>
						<td>1</td>
					</tr>
					<tr>
						<td>2</td>
						<td>2</td>
					</tr>
					<tr>
						<td>1</td>
						<td>3</td>
					</tr>
				</table>
				
				<h3>1.4. Sélectionner et filter des données</h3>
				<h4>Langage SQL</h4>
				<code>
					<span style="color:green">-- Lister tous les utilisateurs</span><br>
					<span style="color:magenta">SELECT</span> * <span style="color:magenta">FROM</span> <span style="color:cyan">Utilisateurs</span>;<br>
					<br>
					<span style="color:green">-- Lister en triant par Nom et Prénom</span><br>
					<span style="color:magenta">SELECT</span> * <span style="color:magenta">FROM</span> <span style="color:cyan">Utilisateurs</span> <span style="color:magenta">ORDER BY</span> Nom, Prenom;<br>
					<br>
					<span style="color:green">-- Lister en triant par Nom dans l'ordre décroissant (par défaut ordre croissant (ASC)</span><br>
					<span style="color:magenta">SELECT</span> * <span style="color:magenta">FROM</span> <span style="color:cyan">Utilisateurs</span> <span style="color:magenta">ORDER BY</span> Nom <span style="color:magenta">DESC</span>; <br>
					<br>
					<span style="color:green">-- Lister Uniquement les noms</span><br>
					<span style="color:magenta">SELECT</span> Nom <span style="color:magenta">FROM</span> <span style="color:cyan">Utilisateurs</span> ; <br>
					<br>
					<span style="color:green">-- Lister sans doublon les prénoms</span><br>
					<span style="color:magenta">SELECT DISTINCT</span> Prenom <span style="color:magenta">FROM</span> <span style="color:cyan">Utilisateurs</span> ; <br>
					<br>
					<span style="color:green">-- Compter les utilisateurs</span><br>
					<span style="color:magenta">SELECT COUNT</span> (*) <span style="color:magenta">FROM</span> <span style="color:cyan">Utilisateurs</span> ; <br>
					<br>
					<span style="color:green">-- Sélectionner les utilisateurs qui s'appelent Martin</span><br>
					<span style="color:magenta">SELECT</span> * <span style="color:magenta">FROM</span> <span style="color:cyan">Utilisateurs</span> <span style="color:magenta">WHERE</span> nom = <span style="color:darkred">'MARTIN'</span> ; <br>
					<br>
					<span style="color:green">-- Sélectionner les utilisateurs dont le nom commence par D</span><br>
					<span style="color:magenta">SELECT</span> * <span style="color:magenta">FROM</span> <span style="color:cyan">Utilisateurs</span> <span style="color:magenta">WHERE</span> nom <span style="color:magenta">LIKE</span> <span style="color:darkred">'D%'</span> ; <br>
					<br>
					<span style="color:green">-- Sélectionner les utilisateurs dont le nom commence fini E</span><br>
					<span style="color:magenta">SELECT</span> * <span style="color:magenta">FROM</span> <span style="color:cyan">Utilisateurs</span> <span style="color:magenta">WHERE</span> nom <span style="color:magenta">LIKE</span> <span style="color:darkred">'%E'</span> ; <br>
					<br>
					<span style="color:green">-- Sélectionner les utilisateurs dont l'ID > 3</span><br>
					<span style="color:magenta">SELECT</span> * <span style="color:magenta">FROM</span> <span style="color:cyan">Utilisateurs</span> <span style="color:magenta">WHERE</span> ID > 3 ; <br>
					<br>
					<span style="color:green">-- Sélectionner les utilisateurs qui ont un mail</span><br>
					<span style="color:magenta">SELECT</span> * <span style="color:magenta">FROM</span> <span style="color:cyan">Utilisateurs</span> <span style="color:magenta">WHERE</span> Mail <span style="color:magenta">IS NOT NULL</span>; <br>
					<br>
				</code>
				
				<h4>1.4.1. Lister le nom des services</h4>
				<h4>1.4.2. Lister les noms et prénoms des utilisateurs par ordre alphabétique</h4>
				<h4>1.4.3. Lister les noms et prénoms des utilisateurs qui n'ont pas d'adresse mail IPSA</h4>
				<h4>1.4.4. Afficher l'utilisateur 5</h4>
				<h4>1.4.5. Lister les adresse MAC des objets de l'utilisateur 2</h4>
				<h4>1.4.6. Lister les adresse MAC des objets de thingtempo</h4>
				<h4>1.4.7. Lister les ID et les noms des utilisateurs qui ne possèdent pas d'objets</h4>
				<h4>1.4.8. Lister les ID et les noms d'utilisateurs qui possèdent des objets</h4>
			
				<h3>1.5. Mettre à jour les données</h3>
				<h4>Langage SQL</h4>
				<code>
					<span style="color:green"> -- Mettre à jour l'adresse mail d'un utilisateur</span> <br>
					<span style="color:magenta">UPDATE</span> <span style="color:cyan">Utilisateur</span> <span style="color:magenta">SET</span> Mail = <span style="color:darkred">'xxx@ipsa.fr'</span> <span style="color:magenta">WHERE</span> ID = id_user ; <br>
					<br>
					<span style="color:green"> -- Ajouter une colonne AGE à Utilisateur</span> <br>
					<span style="color:magenta">ALTER TABLE</span> <span style="color:cyan">Utilisateur</span> <span style="color:magenta">ADD</span> Age <span style="color:MAGENTA">INT NOT NULL DEFAULT</span> <span style="color:darkred">18</span>; <br>
					<br>
					<span style="color:green"> -- Modifier le type de données du champ Email de la table Utilisateur pour pouvoir contenir au maximum 200 caractères</span> <br>
					<span style="color:magenta">ALTER TABLE</span> <span style="color:cyan">Utilisateur</span> <span style="color:magenta">MODIFY</span> Email <span style="color:MAGENTA">VARCHAR</span>(200) ; <br>
					<br>
					<span style="color:green"> -- Changer le nom du champ ID pour devenir ID_Utilisateur</span> <br>
					<span style="color:magenta">ALTER TABLE</span> <span style="color:cyan">Utilisateur</span> <span style="color:magenta">CHANGE</span> ID ID_Utilisateur <span style="color:MAGENTA">INT NOT NULL</span>; <br>
					<br>
				</code>
				<h4>1.5.1. Mettre la valeur NULL à toute la colonne Type de la table Service</h4>
				<h4>1.5.2. Mettre le nom "WatchDog2 pour la ligne d'ID 5</h4>
				<h4>1.5.3. Multiplier par 1.5 toutes les valeurs de paramètres des objets connectés</h4>
				<h4>1.5.4. Modifier le nom du champ Paramètre de la table Objet pour devenir Param</h4>
				<h4>1.5.5. Ajouter un champ "Date_anniversaire" à la table utilisateur</h4>
			
				<h3>1.6. Supprimer des données</h3>
				<h4>Langage SQL</h4>
				<code>
					<span style="color:green">-- Supprimer l'utilisateur avec le nom "Martin</span> <br>
					<span style="color:magenta">DELETE FROM</span> <span style="color:cyan">Utilisateur</span> <span style="color:magenta">WHERE</span> Nom = <span style="color:darkred">'MARTIN'</span> ; <br>
					<br>
					<span style="color:green">-- Supprimer toutes les lignes de la table</span> <br>
					<span style="color:magenta">DELETE FROM</span> <span style="color:cyan">MaTable</span>; <br>
					<br>
					<span style="color:green">-- Supprimer une colonne de la table</span> <br>
					<span style="color:magenta">ALTER TABLE</span> <span style="color:cyan">MaTable</span> <span style="color:magenta">DROP</span> Colonne ; <br>
					<br>
				</code>
				
				<h4>1.6.1. Supprimer l'utilisateur d'ID 1</h4>
				<h4>1.6.2. Supprimer la souscription de l'utilisateur 2 au service 1</h4>
				<h4>1.6.3. Supprimer toutes les lignes de la table objet</h4>
				<h4>1.6.4. Supprimer la colonne "date_anniversaire"</h4>
				<h4>1.6.5. Supprimer la table Objet</h4>
			</div>	
		</div>
		<div class="footer">
			<hr>
			<ul class="footer_list">
				<li id="details">TIn 311 - Initiation aux bases de données</li>
				<li id="td_nb">TD 2</li>
			</ul>
		</div>
		
	</body>
</html>
